---
import Tabs from "./Servicios/Tabs.astro";
import Card from "./Servicios/Card.astro";

import administracionInfraestructura from "../../assets/images/administracion-de-infraestructura.png";
import soporteTecnico from "../../assets/images/soporte-tecnico.png";
import seguridadInformatica from "../../assets/images/seguridad-informatica.png";
import redes from "../../assets/images/redes.png";
import gestionProveedores from "../../assets/images/gestion-de-proveedores.png";
import seguridadFisica from "../../assets/images/seguridad-fisica.png";
import kaizenY5s from "../../assets/images/kaizen-y-5s.png";
import asesoramientoContable from "../../assets/images/asesoramiento-contable-y-administrativo.png";
import capacitaciones from "../../assets/images/capacitaciones.png";
import branding from "../../assets/images/branding.png";
import comunicacionEstrategica from "../../assets/images/comunicacion-estrategica.png";
import diseñoWeb from "../../assets/images/diseño-web.png";
import bgServices from "../../assets/images/bg-services.png";
---

<section id="servicios"
  class="servicios-section overflow-x-hidden py-24 text-center bg-center bg-no-repeat bg-cover"
  style={`background-image: url(${bgServices.src});`}
>
  <div class="contenedor">
    <h2 class="servicios-titulo text-3xl md:text-[42px] font-title">
      ¿Qué ofrecemos?
    </h2>
    <p
      class="servicios-descripcion mb-12 text-base md:text-lg max-w-3xl mx-auto"
    >
      Realizamos soluciones integrales para empresas que necesitan resolver
      problemas complejos dentro de su circuito tanto de gestión como de
      tecnología.
    </p>

    <div class="servicios-tabs">
      <Tabs
        tabs={[
          { id: "it", label: "Consultoría Integral en IT" },
          { id: "gestion", label: "Consultoría en Gestión" },
          { id: "estrategias", label: "Desarrollo de Estrategias" },
        ]}
      >
        <div
          slot="it"
          class="servicios-content text-left p-4 bg-[#1A1631] rounded-4xl"
        >
          <div class="grid grid-cols-1 lg:grid-cols-2 gap-4">
            <Card
            id="administracion-de-infraestructura"
              titulo="Administración de Infraestructura"
              descripcionCorta="Mantenemos todos los dispositivos de red y damos soporte, garantizando conectividad segura y ágil desde cualquier lugar."
              imagen={administracionInfraestructura}
            />
            <Card
            id="soporte-tecnico"
              titulo="Soporte Técnico"
              descripcionCorta="Contamos con un equipo profesional brindando soporte informático integral, ofreciendo asistencia confiable y ágil de forma remota o presencial, para optimizar el rendimiento de tecnología."
              imagen={soporteTecnico}
            />
          </div>
          <div
            class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mt-4"
          >
            <Card
            id="seguridad-informatica"
              titulo="Seguridad Informática"
              descripcionCorta="Protección de datos y backups seguros, tanto físicos como en la nube y controles con periodicidad."
              imagen={seguridadInformatica}
            />
            <Card
            id="redes"
              titulo="Redes"
              descripcionCorta="Eficiencia en la interconectividad de los dispositivos de red, datos y control de ancho de banda."
              imagen={redes}
            />
            <Card
            id="gestion-de-proveedores"
              titulo="Gestión de Proveedores"
              descripcionCorta="Gestionamos proveedores con selección, evaluación de riesgos, negociación y monitoreo."
              imagen={gestionProveedores}
            />
            <Card
            id="seguridad-fisica"
              titulo="Seguridad Física"
              descripcionCorta="Instalación de sistemas de video vigilancia, control de acceso y sistemas de seguridad digitales."
              imagen={seguridadFisica}
            />
          </div>
        </div>

        <div
          slot="gestion"
          class="servicios-content text-left p-4 bg-[#1A1631] rounded-4xl"
        >
          <div class="grid grid-cols-1 lg:grid-cols-2 gap-4">
            <Card
              id="kaizen-y-5s"
              titulo="Kaizen y 5S"
              descripcionCorta={'<b>"Pequeños cambios, grandes resultados"</b><br>Con Kaizen y las 5S, ayudamos a tu empresa a mejorar procesos, reducir desperdicios y aumentar productividad. Cada acción cuenta, cada mejora suma.'}
              imagen={kaizenY5s}
            />
            <Card
              id="asesoramiento-contable-y-administrativo"
              titulo="Asesoramiento Contable y Administrativo"
              descripcionCorta="Mantenemos todos los dispositivos de red y damos soporte, garantizando conectividad segura y ágil desde cualquier lugar."
              imagen={asesoramientoContable}
            />
          </div>
          <div class="flex justify-center mt-4">
            <Card
            id="capacitaciones"
              titulo="Capacitaciones"
              descripcionCorta="Contamos con un equipo profesional brindando soporte informático integral, ofreciendo asistencia confiable y ágil de forma remota o presencial, para optimizar el rendimiento de tecnología."
              imagen={capacitaciones}
              esUnica
            />
          </div>
        </div>

        <div
          slot="estrategias"
          class="servicios-content text-left p-4 bg-[#1A1631] rounded-4xl"
        >
          <div class="grid grid-cols-1 lg:grid-cols-2 gap-4">
            <Card
            id="branding"
              titulo="Branding"
              descripcionCorta="Te ayudamos a construir y fortalecer la identidad de tu marca, creando una presencia sólida y coherente que conecte con tu audiencia y destaque en el mercado."
              imagen={branding}
            />
            <Card
            id="comunicacion-estrategica"
              titulo="Comunicación Estratégica"
              descripcionCorta="Contamos con un equipo profesional brindando soporte informático integral, ofreciendo asistencia confiable y ágil de forma remota o presencial, para optimizar el rendimiento de tecnología."
              imagen={comunicacionEstrategica}
            />
          </div>
          <div class="flex justify-center mt-4">
            <Card
            id="diseno-web"
              titulo="Diseño Web"
              descripcionCorta="Creamos sitios web atractivos y funcionales, optimizados para brindar la mejor experiencia al usuario y cumplir con los objetivos de tu negocio."
              imagen={diseñoWeb}
              esUnica
            />
          </div>
        </div>
      </Tabs>
    </div>
    <a
      href="/servicios"
      class="mt-12 inline-block px-8 py-3 bg-acento text-white rounded-full hover:bg-acentoHover"
    >
      Ver todos los servicios
    </a>
  </div>
</section>

<style>
  .servicios-titulo,
  .servicios-descripcion,
  .servicios-tabs,
  .servicios-content {
    opacity: 0;
    transform: translateY(50px);
  }

  :global(.servicio-card) {
    opacity: 0;
    transform: scale(0.5);
  }
</style>

<script is:inline>
  document.addEventListener("DOMContentLoaded", () => {
    if (window.gsap && window.ScrollTrigger) {
      window.gsap.registerPlugin(window.ScrollTrigger);

      const section = document.querySelector(".servicios-section");
      if (!section) return;

      window.addEventListener('load', () => {
        window.ScrollTrigger.refresh();
      });

      const todasLasCards = section.querySelectorAll(".servicio-card");
      window.gsap.set(todasLasCards, {
        scale: 0.5,
        opacity: 0,
      });

      const titulo = section.querySelector(".servicios-titulo");
      const descripcion = section.querySelector(".servicios-descripcion");

      if (titulo) {
        window.gsap.to(titulo, {
          y: 0,
          opacity: 1,
          duration: 0.3,
          ease: "power2.out",
          scrollTrigger: {
            trigger: section,
            start: "top 60%",
            toggleActions: "play reverse play reverse",
          },
        });
      }

      if (descripcion) {
        window.gsap.to(descripcion, {
          y: 0,
          opacity: 1,
          duration: 0.3,
          delay: 0.05,
          ease: "power2.out",
          scrollTrigger: {
            trigger: section,
            start: "top 60%",
            toggleActions: "play reverse play reverse",
          },
        });
      }

      function animarContenedorYCards(contenedor, animarContenedor = true) {
        const cards = contenedor.querySelectorAll(".servicio-card");
        const tabs = section.querySelector(".servicios-tabs");

        window.gsap.set(cards, {
          scale: 0.5,
          opacity: 0,
        });

        if (animarContenedor) {
          window.gsap.fromTo(
            [contenedor, tabs],
            {
              y: 50,
              opacity: 0,
            },
            {
              y: 0,
              opacity: 1,
              duration: 0.3,
              ease: "power2.out",
            }
          );

          window.gsap.to(cards, {
            scale: 1,
            opacity: 1,
            duration: 0.15,
            ease: "power1.out",
            stagger: 0.03,
            delay: 0.15,
          });
        } else {
          window.gsap.set([contenedor, tabs], { y: 0, opacity: 1 });

          window.gsap.to(cards, {
            scale: 1,
            opacity: 1,
            duration: 0.15,
            ease: "power1.out",
            stagger: 0.03,
          });
        }
      }

      setTimeout(() => {
        const contenedorInicial = section.querySelector(
          ".tab-panel:not([hidden]) .servicios-content"
        );
        if (contenedorInicial) {
          const st = ScrollTrigger.create({
            trigger: contenedorInicial,
            start: "top 80%",
            end: "bottom 20%",
            toggleActions: "play reverse play reverse",
            onEnter: () => {
              animarContenedorYCards(contenedorInicial, true);
            },
            onLeaveBack: () => {
              const cards = contenedorInicial.querySelectorAll(".servicio-card");
              const tabs = section.querySelector(".servicios-tabs");
              window.gsap.to([contenedorInicial, tabs], {
                y: 50,
                opacity: 0,
                duration: 0.3,
                ease: "power2.in",
              });
              window.gsap.to(cards, {
                scale: 0.5,
                opacity: 0,
                duration: 0.15,
                ease: "power1.in",
              });
            },
          });
        }
      }, 100);

      const tabs = section.querySelectorAll('[role="tab"]');
      tabs.forEach((tab) => {
        tab.addEventListener(
          "click",
          () => {
            if (tab.getAttribute("aria-selected") === "true") {
              return;
            }

            const todasLasCards = section.querySelectorAll(".servicio-card");
            window.gsap.set(todasLasCards, {
              scale: 0.5,
              opacity: 0,
            });

            requestAnimationFrame(() => {
              const panelId = tab.getAttribute("data-tab");
              const panel = section.querySelector(`[data-panel="${panelId}"]`);
              if (panel && !panel.hasAttribute("hidden")) {
                const contenedor = panel.querySelector(".servicios-content");
                if (contenedor) {
                  const allTriggers = window.ScrollTrigger.getAll();
                  const otherTriggers = allTriggers.filter(trigger => {
                    if (!trigger.trigger) return false;
                    const triggerElement = trigger.trigger;
                    return !section.contains(triggerElement);
                  });
                  
                  otherTriggers.forEach(trigger => {
                    trigger.disable(false);
                  });
                  
                  animarContenedorYCards(contenedor, false);
                  
                  setTimeout(() => {
                    window.ScrollTrigger.refresh();
                    
                    setTimeout(() => {
                      otherTriggers.forEach(trigger => {
                        trigger.enable(false);
                      });
                    }, 50);
                  }, 350);
                }
              }
            });
          },
          true
        );
      });
    }
  });
</script>
