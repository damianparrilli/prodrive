---
import Tabs from "./Servicios/Tabs.astro";
import Card from "./Servicios/Card.astro";
---

<section
  class="servicios-section overflow-x-hidden py-24 text-center bg-[url(/bg-services.png)] bg-center bg-no-repeat bg-cover"
>
  <div class="contenedor">
    <h2 class="servicios-titulo text-3xl md:text-[42px] font-title">
      ¿Qué ofrecemos?
    </h2>
    <p
      class="servicios-descripcion mb-12 text-base md:text-lg max-w-3xl mx-auto"
    >
      Realizamos soluciones integrales para empresas que necesitan resolver
      problemas complejos dentro de su circuito tanto de gestión como de
      tecnología.
    </p>

    <div class="servicios-tabs">
      <Tabs
        tabs={[
          { id: "it", label: "Consultoría Integral en IT" },
          { id: "gestion", label: "Consultoría en Gestión" },
          { id: "estrategias", label: "Desarrollo de Estrategias" },
        ]}
      >
        <div
          slot="it"
          class="servicios-content text-left p-4 bg-[#1A1631] rounded-4xl"
        >
          <div class="grid grid-cols-1 lg:grid-cols-2 gap-4">
            <Card
            id="administracion-de-infraestructura"
              titulo="Administración de Infraestructura"
              descripcionCorta="Mantenemos todos los dispositivos de red y damos soporte, garantizando conectividad segura y ágil desde cualquier lugar."
              urlImg="administracion-de-infraestructura"
            />
            <Card
            id="soporte-tecnico"
              titulo="Soporte Técnico"
              descripcionCorta="Contamos con un equipo profesional brindando soporte informático integral, ofreciendo asistencia confiable y ágil de forma remota o presencial, para optimizar el rendimiento de tecnología."
              urlImg="soporte-tecnico"
            />
          </div>
          <div
            class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mt-4"
          >
            <Card
            id="seguridad-informatica"
              titulo="Seguridad Informática"
              descripcionCorta="Protección de datos y backups seguros, tanto físicos como en la nube y controles con periodicidad."
              urlImg="seguridad-informatica"
            />
            <Card
            id="redes"
              titulo="Redes"
              descripcionCorta="Eficiencia en la interconectividad de los dispositivos de red, datos y control de ancho de banda."
              urlImg="redes"
            />
            <Card
            id="gestion-de-proveedores"
              titulo="Gestión de Proveedores"
              descripcionCorta="Gestionamos proveedores con selección, evaluación de riesgos, negociación y monitoreo."
              urlImg="gestion-de-proveedores"
            />
            <Card
            id="seguridad-fisica"
              titulo="Seguridad Física"
              descripcionCorta="Instalación de sistemas de video vigilancia, control de acceso y sistemas de seguridad digitales."
              urlImg="seguridad-fisica"
            />
          </div>
        </div>

        <div
          slot="gestion"
          class="servicios-content text-left p-4 bg-[#1A1631] rounded-4xl"
        >
          <div class="grid grid-cols-1 lg:grid-cols-2 gap-4">
            <Card
              id="kaizen-y-5s"
              titulo="Kaizen y 5S"
              descripcionCorta="<b>“Pequeños cambios, grandes resultados”</b><br>Con Kaizen y las 5S, ayudamos a tu empresa a mejorar procesos, reducir desperdicios y aumentar productividad. Cada acción cuenta, cada mejora suma."
              urlImg="kaizen-y-5s"
            />
            <Card
              id="asesoramiento-contable-y-administrativo"
              titulo="Asesoramiento Contable y Administrativo"
              descripcionCorta="Mantenemos todos los dispositivos de red y damos soporte, garantizando conectividad segura y ágil desde cualquier lugar."
              urlImg="asesoramiento-contable-y-administrativo"
            />
          </div>
          <div class="flex justify-center mt-4">
            <Card
            id="capacitaciones"
              titulo="Capacitaciones"
              descripcionCorta="Contamos con un equipo profesional brindando soporte informático integral, ofreciendo asistencia confiable y ágil de forma remota o presencial, para optimizar el rendimiento de tecnología."
              urlImg="capacitaciones"
              esUnica
            />
          </div>
        </div>

        <div
          slot="estrategias"
          class="servicios-content text-left p-4 bg-[#1A1631] rounded-4xl"
        >
          <div class="grid grid-cols-1 lg:grid-cols-2 gap-4">
            <Card
            id="branding"
              titulo="Branding"
              descripcionCorta="Mantenemos todos los dispositivos de red y damos soporte, garantizando conectividad segura y ágil desde cualquier lugar."
              urlImg="branding"
            />
            <Card
            id="comunicacion-estrategica"
              titulo="Comunicación Estratégica"
              descripcionCorta="Contamos con un equipo profesional brindando soporte informático integral, ofreciendo asistencia confiable y ágil de forma remota o presencial, para optimizar el rendimiento de tecnología."
              urlImg="comunicacion-estrategica"
            />
          </div>
          <div class="flex justify-center mt-4">
            <Card
            id="diseño-web"
              titulo="Diseño Web"
              descripcionCorta="Mantenemos todos los dispositivos de red y damos soporte, garantizando conectividad segura y ágil desde cualquier lugar."
              urlImg="diseño-web"
              esUnica
            />
          </div>
        </div>
      </Tabs>
    </div>
    <a
      href=""
      class="mt-12 inline-block px-8 py-3 bg-acento text-white rounded-full hover:bg-acentoHover"
    >
      Ver todos los servicios
    </a>
  </div>
</section>

<style>
  .servicios-titulo,
  .servicios-descripcion,
  .servicios-tabs,
  .servicios-content {
    opacity: 0;
    transform: translateY(50px);
  }

  :global(.servicio-card) {
    opacity: 0;
    transform: scale(0.5);
  }
</style>

<script is:inline>
  document.addEventListener("DOMContentLoaded", () => {
    if (window.gsap && window.ScrollTrigger) {
      window.gsap.registerPlugin(window.ScrollTrigger);

      const section = document.querySelector(".servicios-section");

      const todasLasCards = document.querySelectorAll(".servicio-card");
      window.gsap.set(todasLasCards, {
        scale: 0.5,
        opacity: 0,
      });

      window.gsap.to(".servicios-titulo", {
        y: 0,
        opacity: 1,
        duration: 0.3,
        ease: "power2.out",
        scrollTrigger: {
          trigger: section,
          start: "top 60%",
          toggleActions: "play none none reverse",
        },
      });

      window.gsap.to(".servicios-descripcion", {
        y: 0,
        opacity: 1,
        duration: 0.3,
        delay: 0.05,
        ease: "power2.out",
        scrollTrigger: {
          trigger: section,
          start: "top 60%",
          toggleActions: "play none none reverse",
        },
      });

      function animarContenedorYCards(contenedor, animarContenedor = true) {
        const cards = contenedor.querySelectorAll(".servicio-card");
        const tabs = document.querySelector(".servicios-tabs");

        window.gsap.set(cards, {
          scale: 0.5,
          opacity: 0,
        });

        if (animarContenedor) {
          window.gsap.fromTo(
            [contenedor, tabs],
            {
              y: 50,
              opacity: 0,
            },
            {
              y: 0,
              opacity: 1,
              duration: 0.3,
              ease: "power2.out",
            }
          );

          window.gsap.to(cards, {
            scale: 1,
            opacity: 1,
            duration: 0.15,
            ease: "power1.out",
            stagger: 0.03,
            delay: 0.15,
          });
        } else {
          window.gsap.set([contenedor, tabs], { y: 0, opacity: 1 });

          window.gsap.to(cards, {
            scale: 1,
            opacity: 1,
            duration: 0.15,
            ease: "power1.out",
            stagger: 0.03,
          });
        }
      }

      setTimeout(() => {
        const contenedorInicial = document.querySelector(
          ".tab-panel:not([hidden]) .servicios-content"
        );
        if (contenedorInicial) {
          const st = ScrollTrigger.create({
            trigger: contenedorInicial,
            start: "top 80%",
            once: true,
            onEnter: () => {
              animarContenedorYCards(contenedorInicial, true);
            },
          });
        }
      }, 100);

      const tabs = document.querySelectorAll('[role="tab"]');
      tabs.forEach((tab) => {
        tab.addEventListener(
          "click",
          () => {
            if (tab.getAttribute("aria-selected") === "true") {
              return;
            }

            const todasLasCards = document.querySelectorAll(".servicio-card");
            window.gsap.set(todasLasCards, {
              scale: 0.5,
              opacity: 0,
            });

            requestAnimationFrame(() => {
              const panelId = tab.getAttribute("data-tab");
              const panel = document.querySelector(`[data-panel="${panelId}"]`);
              if (panel && !panel.hasAttribute("hidden")) {
                const contenedor = panel.querySelector(".servicios-content");
                if (contenedor) {
                  animarContenedorYCards(contenedor, false);
                }
              }
            });
          },
          true
        );
      });
    }
  });
</script>
