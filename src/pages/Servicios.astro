---
import Layout from "../layout/Layout.astro";
import BannerServicios from "../components/Servicios/BannerServicios.astro";
import Tabs from "../components/Inicio/Servicios/Tabs.astro";
import It from "../components/Servicios/TipoServicios/It.astro";
import Gestion from "../components/Servicios/TipoServicios/Gestion.astro";
import Desarrollo from "../components/Servicios/TipoServicios/Desarrollo.astro";
import ContactoServicios from "../components/Servicios/ContactoServicios.astro";
---

<Layout title="Servicios - ProDrive" description="" keywords="">
  <div data-page="servicios" class="overflow-x-hidden">
    <BannerServicios titulo="Nuestros servicios" />
    <section class="py-12">
      <div class="flex flex-col justify-center items-center">
        <div class="servicios-tabs w-full">
          <Tabs
            tabs={[
              { id: "it", label: "Consultoría Integral en IT" },
              { id: "gestion", label: "Consultoría en Gestión" },
              { id: "estrategias", label: "Desarrollo de Estrategias" },
            ]}
          >
            <It slot="it" />
            <Gestion slot="gestion" />
            <Desarrollo slot="estrategias" />
          </Tabs>
        </div>
      </div>
    </section>
      <ContactoServicios />
  </div>
</Layout>

<style>
  .scrollbar-hide {
    scrollbar-width: none;
  }

  .scrollbar-hide::-webkit-scrollbar {
    display: none;
  }

  .seccion-contenido {
    opacity: 0;
  }
</style>

<script is:inline>
  document.addEventListener("DOMContentLoaded", () => {
    if (window.gsap && window.ScrollTrigger) {
      window.gsap.registerPlugin(window.ScrollTrigger);

      const itSecciones = document.querySelectorAll(
        '[data-panel="it"] .seccion-contenido'
      );
      const gestionSecciones = document.querySelectorAll(
        '[data-panel="gestion"] .seccion-contenido'
      );
      const desarrolloSecciones = document.querySelectorAll(
        '[data-panel="estrategias"] .seccion-contenido'
      );

      let scrollTriggers = [];

      function animarSecciones(secciones, empiezaDesdeIzquierda = false) {
        secciones.forEach((seccion, index) => {
          let xInicial;

          if (index === 0) {
            const st = window.gsap.fromTo(
              seccion,
              {
                opacity: 0,
                y: 30,
              },
              {
                opacity: 1,
                y: 0,
                duration: 0.8,
                ease: "power2.out",
                scrollTrigger: {
                  trigger: seccion,
                  start: "top 80%",
                  toggleActions: "play none none reset",
                  onLeaveBack: () => {
                    window.gsap.set(seccion, { opacity: 0, y: 30 });
                  },
                },
              }
            );
            if (st.scrollTrigger) scrollTriggers.push(st.scrollTrigger);
          } else {
            if (empiezaDesdeIzquierda) {
              xInicial = index % 2 === 1 ? -100 : 100;
            } else {
              xInicial = index % 2 === 1 ? 100 : -100;
            }

            const st = window.gsap.fromTo(
              seccion,
              {
                opacity: 0,
                x: xInicial,
              },
              {
                opacity: 1,
                x: 0,
                duration: 0.8,
                ease: "power2.out",
                scrollTrigger: {
                  trigger: seccion,
                  start: "top 80%",
                  toggleActions: "play none none reset",
                  onLeaveBack: () => {
                    window.gsap.set(seccion, { opacity: 0, x: xInicial });
                  },
                },
              }
            );
            if (st.scrollTrigger) scrollTriggers.push(st.scrollTrigger);
          }
        });
      }

      animarSecciones(itSecciones, false);
      animarSecciones(gestionSecciones, true);
      animarSecciones(desarrolloSecciones, false);

      const tabs = document.querySelectorAll('[role="tab"]');
      tabs.forEach((tab) => {
        tab.addEventListener("click", () => {
          setTimeout(() => {
            scrollTriggers.forEach((st) => {
              if (st) st.refresh();
            });
          }, 100);
        });
      });
    }
  });
</script>
